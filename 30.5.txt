CREATE TABLE STATS
(
    STAT_ID INT(11) AUTO_INCREMENT PRIMARY KEY,
    STAT_DATE DATETIME NOT NULL,
    STAT VARCHAR(20) NOT NULL,
    VALUE INT(11) NOT NULL
);



CREATE VIEW BESTSELLERS_COUNT AS
SELECT COUNT(*)
FROM books
WHERE IS_BESTSELLER = 1;


USE KODILLA_COURSE;
CREATE EVENT UPDATE_BESTSELLERS
    ON SCHEDULE EVERY 1 MINUTE
    DO
    BEGIN
        CALL UpdateBestsellers();
        INSERT INTO STATS(STAT_DATE, STAT, VALUE)
        SELECT NOW(), 'BESTSELLERS', BESTSELLERS_COUNT
        FROM BESTSELLERS_COUNT;
    END;